SELECT
        CASE
            WHEN user_agent LIKE '%Mobile%' THEN 'Mobile'
            WHEN user_agent LIKE '%Chrome%' THEN 'Chrome'
            WHEN user_agent LIKE '%Firefox%' THEN 'Firefox'
            WHEN user_agent LIKE '%Safari%' THEN 'Safari'
            WHEN user_agent LIKE '%bot%' OR user_agent LIKE '%Bot%' THEN 'Bot'
            ELSE 'Other'
        END as client_type,
        COUNT(*) as request_count
    FROM aws_alb_access_log
    GROUP BY client_type
    ORDER BY request_count DESC;
┌─────────────┬───────────────┐
│ client_type │ request_count │
│   varchar   │     int64     │
├─────────────┼───────────────┤
│ Other       │          6337 │
│ Mobile      │          1842 │
│ Chrome      │          1821 │
└─────────────┴───────────────┘


D SELECT
      ssl_protocol,
      ssl_cipher,
      COUNT(*) as count,
      ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) as percentage
  FROM aws_alb_access_log
  WHERE ssl_protocol != '-'
  GROUP BY ssl_protocol, ssl_cipher
  ORDER BY count DESC;
┌──────────────┬─────────────────────────────┬───────┬────────────┐
│ ssl_protocol │         ssl_cipher          │ count │ percentage │
│   varchar    │           varchar           │ int64 │   double   │
├──────────────┼─────────────────────────────┼───────┼────────────┤
│ TLSv1.2      │ TLS_AES_128_GCM_SHA256      │  1721 │      17.21 │
│ TLSv1.2      │ ECDHE-RSA-AES128-GCM-SHA256 │  1686 │      16.86 │
│ TLSv1.3      │ TLS_AES_128_GCM_SHA256      │  1682 │      16.82 │
│ TLSv1.3      │ ECDHE-RSA-AES256-GCM-SHA384 │  1655 │      16.55 │
│ TLSv1.3      │ ECDHE-RSA-AES128-GCM-SHA256 │  1635 │      16.35 │
│ TLSv1.2      │ ECDHE-RSA-AES256-GCM-SHA384 │  1621 │      16.21 │
└──────────────┴─────────────────────────────┴───────┴────────────┘

D SELECT
      EXTRACT(hour FROM timestamp) as hour_of_day,
      COUNT(*) as request_count
  FROM aws_alb_access_log
  GROUP BY hour_of_day
  ORDER BY request_count DESC;
┌─────────────┬───────────────┐
│ hour_of_day │ request_count │
│    int64    │     int64     │
├─────────────┼───────────────┤
│           6 │           681 │
│           4 │           671 │
│          13 │           665 │
│          10 │           661 │
│           0 │           660 │
│          12 │           658 │
│           2 │           655 │
│           5 │           653 │
│           7 │           653 │
│           8 │           652 │
│           3 │           646 │
│           9 │           646 │
│          14 │           646 │
│           1 │           645 │
│          11 │           640 │
│          15 │           168 │
├─────────────┴───────────────┤
│ 16 rows           2 columns │
└─────────────────────────────┘

 SELECT
      DATE_TRUNC('hour', timestamp) as hour,
      COUNT(*) as total_requests,
      SUM(CASE WHEN alb_status_code >= 400 THEN 1 ELSE 0 END) as error_count,
      ROUND(SUM(CASE WHEN alb_status_code >= 400 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as error_rate
  FROM aws_alb_access_log
  GROUP BY hour
  ORDER BY hour;
┌─────────────────────┬────────────────┬─────────────┬────────────┐
│        hour         │ total_requests │ error_count │ error_rate │
│      timestamp      │     int64      │   int128    │   double   │
├─────────────────────┼────────────────┼─────────────┼────────────┤
│ 2024-11-01 00:00:00 │            660 │         143 │      21.67 │
│ 2024-11-01 01:00:00 │            645 │         127 │      19.69 │
│ 2024-11-01 02:00:00 │            655 │         126 │      19.24 │
│ 2024-11-01 03:00:00 │            646 │         146 │       22.6 │
│ 2024-11-01 04:00:00 │            671 │         142 │      21.16 │
│ 2024-11-01 05:00:00 │            653 │         126 │       19.3 │
│ 2024-11-01 06:00:00 │            681 │         154 │      22.61 │
│ 2024-11-01 07:00:00 │            653 │         133 │      20.37 │
│ 2024-11-01 08:00:00 │            652 │         140 │      21.47 │
│ 2024-11-01 09:00:00 │            646 │         134 │      20.74 │
│ 2024-11-01 10:00:00 │            661 │         137 │      20.73 │
│ 2024-11-01 11:00:00 │            640 │         148 │      23.13 │
│ 2024-11-01 12:00:00 │            658 │         133 │      20.21 │
│ 2024-11-01 13:00:00 │            665 │         156 │      23.46 │
│ 2024-11-01 14:00:00 │            646 │         142 │      21.98 │
│ 2024-11-01 15:00:00 │            168 │          38 │      22.62 │
├─────────────────────┴────────────────┴─────────────┴────────────┤
│ 16 rows                                               4 columns │

D SELECT
      client_ip,
      COUNT(*) as error_count,
      STRING_AGG(request, ', ') as sample_requests
  FROM (
      SELECT DISTINCT client_ip, request
      FROM aws_alb_access_log
      WHERE alb_status_code >= 400
      ORDER BY client_ip, request
      LIMIT 3
  ) AS limited_requests
  GROUP BY client_ip
  ORDER BY error_count DESC
  LIMIT 10;
┌───────────────┬─────────────┬────────────────────────────────┐
│   client_ip   │ error_count │        sample_requests         │
│    varchar    │    int64    │            varchar             │
├───────────────┼─────────────┼────────────────────────────────┤
│ 0.11.129.163  │           1 │ POST /.git/config HTTP/1.1     │
│ 0.152.188.231 │           1 │ DELETE /admin/console HTTP/1.1 │
│ 0.23.226.38   │           1 │ GET /assets/main.css HTTP/1.1  │
└───────────────┴─────────────┴────────────────────────────────┘